МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ


ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

Кафедра «Програмна інженерія»




ЗВІТ
з лаборіторної роботи №4
з дисципліни «Аналіз та рефакторинг коду»
на тему «Розробка IoT клієнта (бізнес-логіки та функцій налаштування)»









Виконав:                                                                Прийняв:
ст. гр. ПЗПІ-23-8                                                   асистент. каф. ПІ. Дашенков Д. С.
Максименко М. В. 






Харків 2025

4.1 Мета роботи
Метою лабораторної роботи №4 є набуття навичок розробки програмного забезпечення для IoT-пристроїв або SmartDevice-систем на основі сучасних платформ для створення вбудованих систем (Embedded Systems). Студент повинен ознайомитися з особливостями програмування мікроконтролерних платформ, організацією взаємодії з датчиками та виконавчими елементами, а також реалізувати функціональний прототип інтелектуального пристрою з можливістю збору, обробки та передачі даних.

4.2 Хід роботи
ІоТ-клієнт було реалізовано у середовищі симуляції Wokwi, що дозволяє моделювати роботу мікроконтролерів, сенсорів та мережевих модулів у режимі реального часу без використання фізичного обладнання. Це дає можливість швидко змінювати схему підключень, налагоджувати програмний код та перевіряти стабільність роботи пристрою, не витрачаючи ресурси на апаратну частину.
Як основну апаратну платформу використано мікроконтролер ESP32 DevKitC, який має вбудований Wi-Fi-модуль та сумісний із бібліотекою WiFi.h. До плати підключено цифровий датчик DHT22, що вимірює температуру та відносну вологість повітря (див. Рисунок 1). Отримані значення використовуються як вхідні дані для серверної частини програмної системи аналізу та догляду за шкірою: вони відображають мікроклімат навколишнього середовища, в якому знаходиться користувач, і надалі можуть впливати на рекомендації щодо догляду.
У створеному IoT-клієнті реалізовано такі основні компоненти (див. Рисунок 1):
• ESP32 DevKitC – мікроконтролер із вбудованим модулем Wi-Fi для підключення до мережі та надсилання HTTP-запитів на сервер.
• DHT22 – цифровий температурно-вологісний сенсор, підключений до 12-го піну мікроконтролера (#define DHTPIN 12, #define DHTTYPE DHT22).
• Модуль Wi-Fi (бібліотека WiFi.h), що встановлює з’єднання з точкою доступу Wokwi-GUEST.
• Бібліотека HTTPClient для формування та відправлення HTTP-запитів методом POST на REST-API серверної частини.
• Порт Serial для виведення діагностичних повідомлень, поточних значень температури й вологості, а також відповідей від сервера (див. Рисунок 2).
Створений функціонал ІоТ-клієнта (див. Рисунок 4):
• ініціалізація датчика DHT22 та послідовного порту (Serial.begin(115200); dht.begin(););
• підключення до Wi-Fi-мережі Wokwi-GUEST з використанням циклу очікування до моменту встановлення з’єднання;
• періодичне зчитування значень вологи (humidity = dht.readHumidity()) та температури (temperature = dht.readTemperature());
• перевірка коректності зчитаних даних (обробка ситуацій, коли isnan(humidity) або isnan(temperature));
• виведення отриманих параметрів у консоль послідовного порту для наочного контролю роботи сенсора (див. Рисунок 2);
• формування JSON-структури, що містить:
o ідентифікатор користувача userId (константа USER_ID),
o виміряну вологість humidity,
o температуру temperature;
• надсилання сформованого JSON об’єкта HTTP-запитом POST на адресу бекенду
SERVER_URL = "http://.../api/iot/environment" з заголовком Content-Type: application/json;
• виведення в консоль коду відповіді сервера та тексту тіла відповіді (responseCode, body), що дозволяє перевірити коректність прийому даних серверною частиною;
• періодичне повторення циклу вимірювання й надсилання даних з інтервалом у 10 секунд (delay(10000);).
Таким чином, реалізований IoT-клієнт забезпечує автоматичний збір даних про температуру і вологість повітря, прив’язує їх до конкретного користувача за допомогою поля userId і передає на серверну частину програмної системи аналізу та догляду за шкірою для подальшої обробки та зберігання.

Рисунок 1 – Схема IoT-пристрою системи аналізу та догляду за шкірою (ESP32 + DHT22 + Wi-Fi)

Рисунок 2 – Вивід показників температури, вологості та відповіді сервера у консоль Serial Monitor

Рисунок 3 – UML-діаграма прецедентів IoT-клієнта системи аналізу та догляду за шкірою

Рисунок 4 – UML-діаграма діяльності IoT-клієнта (цикл вимірювання параметрів та відправлення даних на сервер)
4.3 Бізнес логіка
Бізнес-логіка IoT-клієнта
Бізнес-логіка IoT-клієнта системи аналізу та догляду за шкірою полягає в організації безперервного циклу збору параметрів навколишнього середовища (температури та відносної вологості повітря), їх первинної перевірки та передачі на серверну частину програмної системи з прив’язкою до конкретного користувача. Усі дії виконуються автономно на мікроконтролері ESP32, що дозволяє отримувати актуальні дані без участі користувача. 
Після запуску пристрою у функції setup() відбувається ініціалізація основних компонентів: відкривається послідовний порт для діагностичних повідомлень, ініціалізується датчик DHT22 та встановлюється з’єднання з Wi-Fi-мережею Wokwi-GUEST. Під час підключення контролер перебуває в циклі очікування, поки не буде отримано статус успішного з’єднання. Лише після цього пристрій переходить до основного робочого режиму, що гарантує можливість надсилання даних на сервер. 
Далі бізнес-логіка реалізується в основному циклі loop(). На кожній ітерації клієнт зчитує показники вологості та температури з датчика DHT22. Отримані значення проходять базову валідацію: у разі, якщо датчик повертає некоректні дані (NaN), клієнт фіксує помилку у послідовному порту та робить паузу перед наступною спробою вимірювання. Таким чином запобігається відправлення на сервер некоректних або випадкових значень. 
Якщо показники датчика є валідними, вони виводяться в консоль Serial для наочного контролю роботи сенсора, а потім використовуються для формування JSON-повідомлення. Структура повідомлення містить три ключові параметри: userId (ідентифікатор користувача, для якого фіксуються дані мікроклімату), humidity (вологість повітря) та temperature (температура повітря). Сформований JSON надсилається HTTP-запитом методом POST на REST-ендпоінт серверної частини /api/iot/environment. У разі успішної відправки виводяться код відповіді сервера та текст тіла відповіді, що дає змогу перевірити, чи були дані коректно прийняті та оброблені бекендом. 
Якщо під час роботи з’являються проблеми з мережею (відсутнє підключення до Wi-Fi), IoT-клієнт не намагається надсилати запит, а фіксує відповідне повідомлення у послідовному порту. Це дозволяє одразу відокремити збої зв’язку від можливих помилок у роботі сенсора чи серверної частини. Після завершення всієї послідовності дій клієнт робить паузу тривалістю 10 секунд і повторює цикл зчитування та надсилання даних, забезпечуючи тим самим періодичний моніторинг мікроклімату. 
У підсумку бізнес-логіка IoT-клієнта реалізує автоматизований процес:
зчитування → перевірка → фіксація в логах → формування повідомлення → відправлення на сервер → очікування наступного циклу. Зібрані таким чином параметри температури та вологості прив’язуються до конкретного користувача й можуть використовуватися серверною частиною як додатковий контекст під час аналізу стану шкіри та формування рекомендацій щодо догляду.

ВИСНОВОК
У ході виконання роботи було розроблено та протестовано IoT-клієнт програмної системи аналізу та догляду за шкірою. На базі мікроконтролера ESP32 та датчика DHT22 реалізовано збір параметрів навколишнього середовища (температури та вологості повітря), їх попередню перевірку та періодичну відправку на серверну частину системи через HTTP-протокол у форматі JSON. Підключення до мережі Wi-Fi, взаємодія з REST-API та обробка відповідей сервера були успішно відпрацьовані у середовищі симуляції Wokwi.
Отримані результати підтвердили працездатність обраних архітектурних рішень: IoT-клієнт коректно інтегрується з бекендом, прив’язує виміряні дані до конкретного користувача та може використовуватися як джерело додаткових факторів для аналізу стану шкіри. Таким чином, реалізований модуль створює основу для подальшого розширення системи – наприклад, побудови рекомендацій залежно від мікроклімату або автоматичного відстеження умов, у яких перебуває користувач.
Додаток А
Програмний код IoT клієнта
#include <WiFi.h>
#include <HTTPClient.h>
#include "DHT.h"

#define DHTPIN 12
#define DHTTYPE DHT22

#define WIFI_SSID "Wokwi-GUEST"
#define WIFI_PASSWORD ""

const char *SERVER_URL = "http://consentient-sanjuanita-corymbosely.ngrok-free.dev/api/iot/environment";
const int USER_ID = 1;

DHT dht(DHTPIN, DHTTYPE);

void setup()
{
  Serial.begin(115200);
  dht.begin();

  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to WiFi");

  while (WiFi.status() != WL_CONNECTED)
  {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nWiFi connected");
  Serial.print("IP: ");
  Serial.println(WiFi.localIP());
}

void loop()
{
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();

  if (isnan(humidity) || isnan(temperature))
  {
    Serial.println("Failed to read DHT22");
    delay(5000);
    return;
  }

  Serial.print("Humidity: ");
  Serial.println(humidity);

  Serial.print("Temperature: ");
  Serial.println(temperature);

  if (WiFi.status() == WL_CONNECTED)
  {
    HTTPClient http;
    http.begin(SERVER_URL);
    http.addHeader("Content-Type", "application/json");

    String payload = "{";
    payload += "\"userId\":" + String(USER_ID) + ",";
    payload += "\"humidity\":" + String(humidity) + ",";
    payload += "\"temperature\":" + String(temperature);
    payload += "}";

    int responseCode = http.POST(payload);
    Serial.print("POST response: ");
    Serial.println(responseCode);

    String body = http.getString();
    Serial.print("Response body: ");
    Serial.println(body);

    http.end();
  }
  else
  {
    Serial.println("WiFi not connected");
  }

  delay(10000);
}


ДОДАТОК В
Посилання на відео:
https://youtu.be/1t3RcG8g6EQ
